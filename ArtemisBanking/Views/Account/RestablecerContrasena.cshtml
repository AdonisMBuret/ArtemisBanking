@model ArtemisBanking.Web.ViewModels.Account.RestablecerContrasenaViewModel

@{
    ViewData["Title"] = "Restablecer Contraseña";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- ==================== PÁGINA DE RESTABLECER CONTRASEÑA ==================== -->
<div class="row justify-content-center align-items-center" style="min-height: 70vh;">
    <div class="col-md-5 col-lg-4">
        <!-- Tarjeta principal -->
        <div class="card-artemis">
            <!-- Encabezado -->
            <div class="card-artemis-header text-center py-4">
                <i class="fas fa-lock-open fa-3x mb-3"></i>
                <h3 class="mb-0">Nueva Contraseña</h3>
            </div>

            <!-- Cuerpo del formulario -->
            <div class="card-artemis-body p-4">
                <!-- Mensaje informativo -->
                <div class="alert alert-success-artemis mb-4" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Token Validado</strong>
                    <p class="mb-0 mt-2" style="font-size: 0.9rem;">
                        Ahora puedes establecer una nueva contraseña para tu cuenta.
                    </p>
                </div>

                <!-- Formulario -->
                <form asp-action="RestablecerContrasena" method="post">
                    <!-- Campos ocultos (token y userId) -->
                    <input asp-for="UsuarioId" type="hidden" />
                    <input asp-for="Token" type="hidden" />

                    <!-- Validación general -->
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger-artemis"></div>

                    <!-- Campo: Nueva Contraseña -->
                    <div class="mb-3">
                        <label asp-for="Contrasena" class="form-label-artemis">
                            <i class="fas fa-key me-2"></i>Nueva Contraseña
                        </label>
                        <input asp-for="Contrasena"
                               class="form-control form-control-artemis"
                               type="password"
                               placeholder="Mínimo 8 caracteres"
                               autocomplete="new-password" />
                        <span asp-validation-for="Contrasena" class="text-danger"></span>

                        <!-- Requisitos de contraseña -->
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle me-1"></i>
                            Debe contener: mayúsculas, minúsculas, números y caracteres especiales
                        </small>
                    </div>

                    <!-- Campo: Confirmar Contraseña -->
                    <div class="mb-4">
                        <label asp-for="ConfirmarContrasena" class="form-label-artemis">
                            <i class="fas fa-check-double me-2"></i>Confirmar Contraseña
                        </label>
                        <input asp-for="ConfirmarContrasena"
                               class="form-control form-control-artemis"
                               type="password"
                               placeholder="Repita la contraseña"
                               autocomplete="new-password" />
                        <span asp-validation-for="ConfirmarContrasena" class="text-danger"></span>
                    </div>

                    <!-- Indicador de fortaleza de contraseña (visual) -->
                    <div class="mb-4">
                        <div class="progress" style="height: 5px;">
                            <div id="password-strength-bar"
                                 class="progress-bar"
                                 role="progressbar"
                                 style="width: 0%; background-color: var(--color-danger);">
                            </div>
                        </div>
                        <small id="password-strength-text" class="text-muted">
                            Ingrese una contraseña
                        </small>
                    </div>

                    <!-- Botones -->
                    <div class="d-grid gap-2">
                        <!-- Botón restablecer -->
                        <button type="submit" class="btn btn-primary-artemis">
                            <i class="fas fa-save me-2"></i>
                            Restablecer Contraseña
                        </button>

                        <!-- Botón cancelar -->
                        <a asp-action="Login" class="btn btn-outline-artemis">
                            <i class="fas fa-times me-2"></i>
                            Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ==================== SCRIPTS ==================== -->
@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Script simple para mostrar fortaleza de contraseña
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.querySelector('input[type="password"]');
            const strengthBar = document.getElementById('password-strength-bar');
            const strengthText = document.getElementById('password-strength-text');

            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    const password = this.value;
                    let strength = 0;

                    // Calcular fortaleza
                    if (password.length >= 8) strength += 25;
                    if (password.match(/[a-z]/)) strength += 25;
                    if (password.match(/[A-Z]/)) strength += 25;
                    if (password.match(/[0-9]/)) strength += 15;
                    if (password.match(/[^a-zA-Z0-9]/)) strength += 10;

                    // Actualizar barra
                    strengthBar.style.width = strength + '%';

                    // Cambiar color según fortaleza
                    if (strength < 40) {
                        strengthBar.style.backgroundColor = '#8B4513'; // Marrón rojizo
                        strengthText.textContent = 'Contraseña débil';
                        strengthText.style.color = '#8B4513';
                    } else if (strength < 70) {
                        strengthBar.style.backgroundColor = '#CD853F'; // Marrón dorado
                        strengthText.textContent = 'Contraseña media';
                        strengthText.style.color = '#CD853F';
                    } else {
                        strengthBar.style.backgroundColor = '#5C7C5D'; // Verde oliva
                        strengthText.textContent = 'Contraseña fuerte';
                        strengthText.style.color = '#5C7C5D';
                    }
                });
            }
        });
    </script>
}